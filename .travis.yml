language: python

python:
    - "3.8"

services:
    - docker

before_script: docker pull mkroutikov/redstork:latest

script:
    - docker run -v`pwd`:/self mkroutikov/redstork:latest bash -c "make wheel"
    - pip install twine

after_script:
    - twine upload dist/*.whl -u __token__

deploy:
    provider: pypi
    distributions: "bdist_wheel" # Your distributions here
    skip_cleanup: true
    on:
        tags: true
    user: "__token__"
    password:
        secure: "Your encrypted token"

